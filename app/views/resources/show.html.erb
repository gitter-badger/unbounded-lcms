<% set_page_title @resource.page_title(@grade_color_code) %>
<% set_og_tags @resource.page_title(@grade_color_code), @resource.teaser %>

<% if (slug = @curriculum.slug) %>
  <% set_canonical_url show_with_slug_path(slug.value) %>
<% end %>

<div class="o-page o-page--margin-to-bottom o-page--resource">
  <div class="o-page__sticky">
    <div class="o-sticky o-sticky--left <%= 'o-sticky--disabled' unless @curriculum.previous_of_type %>">
      <a class="o-sticky__btn o-sticky--left__btn" href="<%= @curriculum.previous_of_type ? show_with_slug_path(@curriculum.previous_of_type.slug.value) : '#' %>">
        <div class="o-page__wrap--row o-sticky__wrap o-sticky__wrap--left">
          <div class="o-sticky__icon <%= 'u-link--disabled' unless @curriculum.previous_of_type %>">
            <i class="fa-3x ub-angle-left"></i>
          </div>
          <% if @curriculum.previous_of_type %>
            <div class="o-sticky__txt hide-for-small-only">
              <div class="o-sticky__arrow-subheader"><%= t('resources.btn.arrow', dir: 'Previous', type: type_name(@curriculum.previous_of_type)) %></div>
              <div class="o-sticky__arrow-header"><%= @curriculum.previous_of_type.resource.title %></div>
            </div>
          <% end %>
          <div class="o-sticky__txt show-for-small-only <%= 'u-link--disabled' unless @curriculum.previous_of_type %>">
            <div class="o-sticky__arrow-subheader"><%= t('resources.btn.arrow-small', dir: 'Previous', type:  @curriculum.current_level.capitalize) %></div>
            <div class="o-sticky__arrow-header"><%= t('resources.btn.arrow-txt-small') %></div>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="o-page__module">
    <div class="o-page__wrap--row">
      <div class="o-page__module u-margin-bottom--gutter">
        <%= link_to back_to_curriculum_path(@curriculum), class: 'o-btn o-btn--base' do %>
          <i class="fa-lg ub-arrow-left"></i> <%= t('resources.btn.back') %>
        <% end %>
        <% if user_signed_in? %>
          <%= link_to edit_admin_resource_path(@resource), class: 'o-btn o-btn--base' do %>
            <%= t('ui.edit') %>
          <% end %>
        <% end %>
      </div>
      <div class="o-page__section cs-bg--<%= @resource.color_code(@grade_color_code) %> u-br-top-right--base">
        <div class="o-content-title u-text--capitalized">
          <%
            @curriculum.self_and_ancestors.reverse.each_with_index do |ancestor, idx|
              is_last = ancestor.id == @curriculum.id
              piece = is_last ?
                @curriculum.resource.short_title :
                ancestor.breadcrumb_piece
          %>
            <% if idx == 0 %>
              <%= piece %>
            <% else %>
              <%= link_to piece, show_with_slug_path(ancestor.slug.value) %>
            <% end %>
            <%= ' / ' if !is_last %>
          <% end %>
        </div>
      </div>
      <div class="o-page__section u-padding-top--gutter u-bg--light u-br-top-right--base u-br-bottom--base">
        <div class="o-resource-title">
          <div class="o-resource-title__title">
            <div class="o-title u-text--uppercase">
              <span class="o-title__type cs-txt--<%= @resource.color_code(@grade_color_code) %>"><%= @resource.short_title %></span>
              <span class="o-title__duration"><%= react_component('TimeToTeach', {duration: @resource.time_to_teach}, prerender: true) %></span>
            </div>
            <h1><%= @resource.title %></h1>
            <div class="u-txt--teaser o-social-sharing__teaser">
              <%= @resource.teaser %>
            </div>
          </div>
          <div class="o-resource-title__links">
            <div>
              <!--button class="o-ub-btn" data-open="downloads-modal"><%= t('resources.btn.download', title: @curriculum.type_name) %></button-->
              <a class="o-ub-btn o-ub-btn--yellow" href="#resource-downloads-list"><%= t('resources.btn.download', title: @curriculum.type_name) %></a>
            </div>
            <div>
              <%= link_to t('resources.btn.related'), '#related-instruction', class: 'o-ub-btn o-ub-btn--2bordered-gray' %>
            </div>
          </div>
        </div>
        <hr class="o-resource-hr">
        <div class="o-resource-summary u-padding-bottom--gutter">
          <div class="o-resource-summary__map">
            <div class="o-resource-summary__title">
              <strong><%= @curriculum.subject_and_grade_title %> Curriculum Map</strong>
            </div>
            <%= react_component('CurriculumMap', @props, prerender: true) %>
            <%= render partial: 'shared/social_sharing', locals: { resource: @resource, cl: 'u-margin-top--base' } %>
          </div>
          <div class="o-resource-summary__content">
            <div class="o-resource__item o-resource__item--description">
              <h3>Description</h3>
              <%= @resource.description.try(:html_safe) %>
            </div>
            <div id="resource-downloads-list" class="o-resource__item">
              <h3>Downloads</h3>
              <ul class="o-resource__list o-resource__list--icons o-resource__list--<%= @resource.color_code %>">
                <% @resource.download_categories.each do |k, downloads| %>
                  <strong><%= k.presence || t('resources.title.download_category') %></strong>
                  <% downloads.each do |download| %>
                    <%= render partial: 'resources/download', locals: { download: download, curriculum: @curriculum } %>
                  <% end %>
                <% end %>
                <% if @resource.downloads.empty? %>
                  <span>There are no downloads for this resource</span>
                <% end %>
              </ul>
            </div>
            <%= render partial: 'resources/prerequisites_standards', locals: { standards: @resource.prerequisites_standards, color_code: @resource.color_code } %>
            <%= render_tag_clouds(@curriculum.named_tags, @resource.color_code) %>
            <% if @resource.engageny_url %>
            <div class="o-resource__item  o-resource__item--credits">
              <h3>Credits</h3>
              <%= render partial: 'resources/engageny', locals: { curriculum: @curriculum, resource: @resource, color_code: @resource.color_code(@grade_color_code) } %>
            </div>
            <% end %>
          </div>
        </div>
        <% if !@curriculum.lesson? %>
          <div class="o-resource-summary--2x u-pd-content--xlarge cs-tint-bg--<%= @resource.color_code(@grade_color_code) %> u-br-bottom--base">
            <div class="o-resource-summary__map o-resource-summary__map--2x"></div>
            <div class="o-resource-summary__content--2x">
              <%= render partial: 'resources/children_list', locals: { curriculum: @curriculum, color_code: @resource.color_code } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="o-page__sticky">
    <div class="o-sticky o-sticky--right <%= 'o-sticky--disabled' unless @curriculum.next_of_type %>">
      <a class="o-sticky__btn o-sticky--right__btn" href="<%= @curriculum.next_of_type ? show_with_slug_path(@curriculum.next_of_type.slug.value) : '#' %>">
        <div class="o-page__wrap--row o-sticky__wrap o-sticky__wrap--right">
          <% if  @curriculum.next_of_type %>
            <div class="o-sticky__txt hide-for-small-only">
              <div class="o-sticky__arrow-subheader"><%= t('resources.btn.arrow', dir: 'Next', type: type_name(@curriculum.next_of_type)) %></div>
              <div class="o-sticky__arrow-header"><%= @curriculum.next_of_type.resource.title %></div>
            </div>
          <% end %>
          <div class="o-sticky__txt show-for-small-only <%= 'u-link--disabled' unless @curriculum.next_of_type %>">
            <div class="o-sticky__arrow-subheader"><%= t('resources.btn.arrow-small', dir: 'Next', type: @curriculum.current_level.capitalize) %></div>
            <div class="o-sticky__arrow-header"><%= t('resources.btn.arrow-txt-small') %></div>
          </div>
          <div class="o-sticky__icon <%= 'u-link--disabled' unless @curriculum.next_of_type %>">
            <i class="fa-3x ub-angle-right"></i>
          </div>
        </div>
      </a>
    </div>
  </div>
</div>
<div id="related-instruction" class="u-bg--light">
  <div class="o-page">
     <%= react_component('RelatedInstruction',
                        { id: @resource.id,
                          resource_type: @curriculum.curriculum_type.name,
                          has_more: @has_more,
                          instructions: @instructions },
                          prerender: true) %>
  </div>
</div>
